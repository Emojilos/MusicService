<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Too Loud</title>
  <link rel="stylesheet" href="main.css" />
</head>
<body>

  <!-- Auth View -->
  <div id="view-auth" class="view active">
    <div class="auth-container">
      <h1 class="auth-logo">Too Loud</h1>

      <div id="auth-form-login" class="auth-form">
        <h2>Вход</h2>
        <div class="form-group">
          <label>Email</label>
          <input type="email" id="login-email" placeholder="you@example.com" autocomplete="email" />
        </div>
        <div class="form-group">
          <label>Пароль</label>
          <input type="password" id="login-password" placeholder="Пароль" autocomplete="current-password" />
        </div>
        <p id="login-error" class="auth-error"></p>
        <button id="btn-login" class="btn-auth-submit">Войти</button>
        <p class="auth-toggle">Нет аккаунта? <button id="btn-show-register" class="btn-auth-link">Создать</button></p>
      </div>

      <div id="auth-form-register" class="auth-form hidden">
        <h2>Регистрация</h2>
        <div class="form-group">
          <label>Email</label>
          <input type="email" id="register-email" placeholder="you@example.com" autocomplete="email" />
        </div>
        <div class="form-group">
          <label>Пароль</label>
          <input type="password" id="register-password" placeholder="Минимум 6 символов" autocomplete="new-password" />
        </div>
        <div class="form-group">
          <label>Подтверждение пароля</label>
          <input type="password" id="register-confirm" placeholder="Повтори пароль" autocomplete="new-password" />
        </div>
        <p id="register-error" class="auth-error"></p>
        <button id="btn-register" class="btn-auth-submit">Создать аккаунт</button>
        <p class="auth-toggle">Уже есть аккаунт? <button id="btn-show-login" class="btn-auth-link">Войти</button></p>
      </div>
    </div>
  </div>

  <!-- Views -->
  <div id="view-albums" class="view">
    <header>
      <div class="library-header">
        <h1>Library</h1>
        <div class="library-header-actions">
          <button id="btn-logout" class="btn-logout" title="Выйти">
            <svg viewBox="0 0 24 24" fill="currentColor" width="18" height="18"><path d="M17 7l-1.41 1.41L18.17 11H8v2h10.17l-2.58 2.58L17 17l5-5-5-5zM4 5h8V3H4c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h8v-2H4V5z"/></svg>
          </button>
          <button id="btn-jamendo-search" class="btn-jamendo-search" title="Найти на Jamendo">
            <svg viewBox="0 0 24 24" fill="currentColor" width="16" height="16"><path d="M15.5 14h-.79l-.28-.27A6.471 6.471 0 0 0 16 9.5 6.5 6.5 0 1 0 9.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 4.99L20.49 19l-4.99-5zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14z"/></svg>
          </button>
          <button id="btn-add-album" class="btn-add-album" title="Добавить альбом">+</button>
        </div>
      </div>
    </header>
    <div id="albums-grid" class="albums-grid"></div>
  </div>

  <!-- Home View -->
  <div id="view-home" class="view">
    <header>
      <div class="library-header">
        <h1>Главная</h1>
        <div class="library-header-actions">
          <button id="btn-logout-home" class="btn-logout" title="Выйти">
            <svg viewBox="0 0 24 24" fill="currentColor" width="18" height="18"><path d="M17 7l-1.41 1.41L18.17 11H8v2h10.17l-2.58 2.58L17 17l5-5-5-5zM4 5h8V3H4c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h8v-2H4V5z"/></svg>
          </button>
        </div>
      </div>
    </header>

    <section class="home-section" id="home-last-played-section">
      <h2 class="home-section-title">Продолжить прослушивание</h2>
      <div id="home-last-played"></div>
    </section>

    <section class="home-section">
      <h2 class="home-section-title">Недавно добавленные</h2>
      <div id="home-recent-albums" class="albums-grid"></div>
    </section>
  </div>

  <div id="view-tracks" class="view">
    <header>
      <button id="btn-back" class="btn-back">← Back</button>
      <div id="album-header" class="album-header">
        <div id="album-cover-wrapper" class="album-cover-wrapper">
          <img id="album-cover-big" src="" alt="" />
          <div class="album-cover-overlay">
            <svg viewBox="0 0 24 24" fill="currentColor" width="28" height="28"><path d="M12 15.2A3.2 3.2 0 0 1 8.8 12 3.2 3.2 0 0 1 12 8.8 3.2 3.2 0 0 1 15.2 12 3.2 3.2 0 0 1 12 15.2M12 7a5 5 0 0 0-5 5 5 5 0 0 0 5 5 5 5 0 0 0 5-5 5 5 0 0 0-5-5m-7 2H3v10a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2V9h-2l-2-2H9L7 9Z"/></svg>
          </div>
        </div>
        <input type="file" id="change-cover-input" accept="image/*" hidden />
        <div class="album-meta">
          <h2 id="album-title"></h2>
          <span id="album-artist"></span>
          <span id="album-year"></span>
        </div>
      </div>
    </header>
    <ul id="track-list" class="track-list"></ul>
  </div>

  <!-- Favorites & Playlists View -->
  <div id="view-favorites" class="view">
    <header>
      <div class="library-header">
        <h1>Любимые</h1>
      </div>
    </header>

    <section class="home-section">
      <h2 class="home-section-title">Любимые треки</h2>
      <ul id="favorites-list" class="track-list"></ul>
    </section>

    <section class="home-section">
      <div class="section-header-row">
        <h2 class="home-section-title">Плейлисты</h2>
        <button id="btn-create-playlist" class="btn-create-playlist">+ Создать</button>
      </div>
      <div id="playlists-grid" class="playlists-grid"></div>
    </section>
  </div>

  <!-- Playlist Detail View -->
  <div id="view-playlist" class="view">
    <header>
      <button id="btn-back-playlist" class="btn-back">← Назад</button>
      <div class="album-header">
        <div class="playlist-cover-icon">
          <svg viewBox="0 0 24 24" fill="currentColor" width="48" height="48"><path d="M15 6H3v2h12V6zm0 4H3v2h12v-2zM3 16h8v-2H3v2zM17 6v8.18c-.31-.11-.65-.18-1-.18-1.66 0-3 1.34-3 3s1.34 3 3 3 3-1.34 3-3V8h3V6h-5z"/></svg>
        </div>
        <div class="album-meta">
          <h2 id="playlist-title"></h2>
          <span id="playlist-track-count" style="color:var(--muted);font-size:13px;"></span>
        </div>
      </div>
    </header>
    <ul id="playlist-track-list" class="track-list"></ul>
  </div>

  <!-- Player (persistent) -->
  <div id="player" class="player hidden">

    <!-- Прогресс с временем над ползунком -->
    <div class="player-progress-wrapper">
      <div class="player-progress">
        <div class="progress-labels">
          <span id="time-current">0:00</span>
          <span id="time-total">0:00</span>
        </div>
        <input id="progress-bar" type="range" min="0" max="1000" value="0" />
      </div>
    </div>

    <!-- Основная панель -->
    <div class="player-main">
      <div class="player-info">
        <img id="player-cover" src="" alt="" />
        <div class="player-text">
          <span id="player-track"></span>
          <span id="player-artist"></span>
        </div>
        <button id="btn-player-heart" class="btn-player-heart" title="В избранное">
          <svg viewBox="0 0 24 24" fill="currentColor" width="18" height="18"><path d="M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z"/></svg>
        </button>
      </div>

      <!-- Кнопка play только для мини-плеера на мобилке -->
      <button id="btn-mini-play" class="btn-mini-play" title="Play/Pause">
        <svg viewBox="0 0 24 24" fill="currentColor"><path d="M8 5v14l11-7z"/></svg>
      </button>

      <div class="player-center">
        <div class="player-controls">
          <button id="btn-shuffle" title="Shuffle">
            <svg viewBox="0 0 24 24" fill="currentColor"><path d="M10.59 9.17L5.41 4 4 5.41l5.17 5.17 1.42-1.41zM14.5 4l2.04 2.04L4 18.59 5.41 20 17.96 7.46 20 9.5V4h-5.5zm.33 9.41l-1.41 1.41 3.13 3.13L14.5 20H20v-5.5l-2.04 2.04-3.13-3.13z"/></svg>
          </button>
          <button id="btn-prev" title="Previous">
            <svg viewBox="0 0 24 24" fill="currentColor"><path d="M6 6h2v12H6zm3.5 6 8.5 6V6z"/></svg>
          </button>
          <button id="btn-play" title="Play/Pause">
            <svg viewBox="0 0 24 24" fill="currentColor"><path d="M8 5v14l11-7z"/></svg>
          </button>
          <button id="btn-next" title="Next">
            <svg viewBox="0 0 24 24" fill="currentColor"><path d="M6 18l8.5-6L6 6v12zM16 6v12h2V6h-2z"/></svg>
          </button>
          <button id="btn-repeat" title="Repeat">
            <svg viewBox="0 0 24 24" fill="currentColor"><path d="M7 7h10v3l4-4-4-4v3H5v6h2V7zm10 10H7v-3l-4 4 4 4v-3h12v-6h-2v4z"/></svg>
          </button>
        </div>
      </div>

      <div class="player-volume">
        <svg class="volume-icon" viewBox="0 0 24 24" fill="currentColor"><path d="M3 9v6h4l5 5V4L7 9H3zm13.5 3c0-1.77-1.02-3.29-2.5-4.03v8.05c1.48-.73 2.5-2.25 2.5-4.02z"/></svg>
        <input id="volume-bar" type="range" min="0" max="1" step="0.01" value="0.8" />
      </div>
    </div>

  </div>

  <!-- Полноэкранный плеер (мобилка) -->
  <div id="player-fullscreen" class="player-fullscreen">
    <div class="pf-handle-bar"></div>
    <img id="pf-cover" class="pf-cover" src="" alt="" />
    <div class="pf-info">
      <span id="pf-track"></span>
      <span id="pf-artist"></span>
    </div>
    <div class="pf-progress-section">
      <input id="pf-progress" type="range" min="0" max="1000" value="0" />
      <div class="pf-time-labels">
        <span id="pf-time-current">0:00</span>
        <span id="pf-time-total">0:00</span>
      </div>
    </div>
    <div class="pf-controls">
      <button id="pf-shuffle" title="Shuffle">
        <svg viewBox="0 0 24 24" fill="currentColor"><path d="M10.59 9.17L5.41 4 4 5.41l5.17 5.17 1.42-1.41zM14.5 4l2.04 2.04L4 18.59 5.41 20 17.96 7.46 20 9.5V4h-5.5zm.33 9.41l-1.41 1.41 3.13 3.13L14.5 20H20v-5.5l-2.04 2.04-3.13-3.13z"/></svg>
      </button>
      <button id="pf-prev" title="Previous">
        <svg viewBox="0 0 24 24" fill="currentColor"><path d="M6 6h2v12H6zm3.5 6 8.5 6V6z"/></svg>
      </button>
      <button id="pf-play" title="Play/Pause">
        <svg viewBox="0 0 24 24" fill="currentColor"><path d="M8 5v14l11-7z"/></svg>
      </button>
      <button id="pf-next" title="Next">
        <svg viewBox="0 0 24 24" fill="currentColor"><path d="M6 18l8.5-6L6 6v12zM16 6v12h2V6h-2z"/></svg>
      </button>
      <button id="pf-repeat" title="Repeat">
        <svg viewBox="0 0 24 24" fill="currentColor"><path d="M7 7h10v3l4-4-4-4v3H5v6h2V7zm10 10H7v-3l-4 4 4 4v-3h12v-6h-2v4z"/></svg>
      </button>
    </div>
  </div>

  <!-- Bottom Navigation -->
  <nav id="bottom-nav" class="bottom-nav hidden">
    <button class="nav-btn active" data-view="home" title="Главная">
      <svg viewBox="0 0 24 24" fill="currentColor" width="22" height="22"><path d="M10 20v-6h4v6h5v-8h3L12 3 2 12h3v8z"/></svg>
      <span>Главная</span>
    </button>
    <button class="nav-btn" data-view="albums" title="Библиотека">
      <svg viewBox="0 0 24 24" fill="currentColor" width="22" height="22"><path d="M12 3v10.55c-.59-.34-1.27-.55-2-.55-2.21 0-4 1.79-4 4s1.79 4 4 4 4-1.79 4-4V7h4V3h-6z"/></svg>
      <span>Библиотека</span>
    </button>
    <button class="nav-btn" data-view="favorites" title="Любимые">
      <svg viewBox="0 0 24 24" fill="currentColor" width="22" height="22"><path d="M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z"/></svg>
      <span>Любимые</span>
    </button>
  </nav>

  <audio id="audio"></audio>

  <!-- Upload Modal -->
  <div id="upload-modal" class="modal-overlay hidden">
    <div class="modal-box">
      <h2>Новый альбом</h2>

      <div class="form-group">
        <label>Название</label>
        <input type="text" id="upload-title" placeholder="Название альбома" />
      </div>
      <div class="form-group">
        <label>Артист</label>
        <input type="text" id="upload-artist" placeholder="Артист" />
      </div>
      <div class="form-group">
        <label>Год</label>
        <input type="number" id="upload-year" placeholder="2024" min="1900" max="2099" />
      </div>

      <div class="form-group">
        <label>Обложка</label>
        <div class="drop-zone" id="cover-drop-zone">
          <span id="cover-drop-hint">Перетащи или кликни для выбора изображения</span>
          <input type="file" id="upload-cover" accept="image/*" hidden />
        </div>
      </div>

      <div class="form-group">
        <label>Треки</label>
        <div class="drop-zone" id="tracks-drop-zone">
          <span id="tracks-drop-hint">Перетащи или кликни для выбора аудио</span>
          <input type="file" id="upload-tracks" accept="audio/*" multiple hidden />
        </div>
      </div>

      <ul id="modal-track-list" class="modal-tracks-list"></ul>

      <div class="modal-actions">
        <button id="upload-cancel" class="btn-modal-cancel">Отмена</button>
        <button id="upload-save" class="btn-modal-save">Сохранить</button>
      </div>
    </div>
  </div>

  <input type="file" id="add-tracks-input" accept="audio/*" multiple hidden />

  <!-- Jamendo Search Modal -->
  <div id="jamendo-modal" class="modal-overlay hidden">
    <div class="modal-box modal-box--wide">
      <h2>Найти альбом на Jamendo</h2>
      <div class="jamendo-search-row">
        <input type="text" id="jamendo-query" class="jamendo-query-input" placeholder="Название альбома или артиста…" />
        <button id="jamendo-search-btn" class="btn-modal-save">Найти</button>
      </div>
      <div id="jamendo-results" class="jamendo-results">
        <p id="jamendo-status" class="jamendo-status"></p>
      </div>
      <div class="modal-actions">
        <button id="jamendo-cancel" class="btn-modal-cancel">Закрыть</button>
        <button id="jamendo-import" class="btn-modal-save" disabled>Добавить в библиотеку</button>
      </div>
    </div>
  </div>

  <!-- Create Playlist Modal -->
  <div id="create-playlist-modal" class="modal-overlay hidden">
    <div class="modal-box">
      <h2>Новый плейлист</h2>
      <div class="form-group">
        <label>Название</label>
        <input type="text" id="playlist-name-input" placeholder="Название плейлиста" />
      </div>
      <div class="modal-actions">
        <button id="create-playlist-cancel" class="btn-modal-cancel">Отмена</button>
        <button id="create-playlist-save" class="btn-modal-save">Создать</button>
      </div>
    </div>
  </div>

  <!-- Add to Playlist Modal -->
  <div id="add-to-playlist-modal" class="modal-overlay hidden">
    <div class="modal-box modal-box--narrow">
      <h2>Добавить в плейлист</h2>
      <div id="add-to-playlist-list" class="add-to-playlist-list"></div>
      <div class="modal-actions">
        <button id="add-to-playlist-cancel" class="btn-modal-cancel">Отмена</button>
      </div>
    </div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <script src="supabase-config.js"></script>
  <script src="app.js"></script>
</body>
</html>
