<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Music</title>
  <link rel="stylesheet" href="main.css" />
</head>
<body>

  <!-- Views -->
  <div id="view-albums" class="view active">
    <header>
      <div class="library-header">
        <h1>Library</h1>
        <button id="btn-add-album" class="btn-add-album" title="Добавить альбом">+</button>
      </div>
    </header>
    <div id="albums-grid" class="albums-grid"></div>
  </div>

  <div id="view-tracks" class="view">
    <header>
      <button id="btn-back" class="btn-back">← Back</button>
      <div id="album-header" class="album-header">
        <div id="album-cover-wrapper" class="album-cover-wrapper">
          <img id="album-cover-big" src="" alt="" />
          <div class="album-cover-overlay">
            <svg viewBox="0 0 24 24" fill="currentColor" width="28" height="28"><path d="M12 15.2A3.2 3.2 0 0 1 8.8 12 3.2 3.2 0 0 1 12 8.8 3.2 3.2 0 0 1 15.2 12 3.2 3.2 0 0 1 12 15.2M12 7a5 5 0 0 0-5 5 5 5 0 0 0 5 5 5 5 0 0 0 5-5 5 5 0 0 0-5-5m-7 2H3v10a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2V9h-2l-2-2H9L7 9Z"/></svg>
          </div>
        </div>
        <input type="file" id="change-cover-input" accept="image/*" hidden />
        <div class="album-meta">
          <h2 id="album-title"></h2>
          <span id="album-artist"></span>
          <span id="album-year"></span>
        </div>
      </div>
    </header>
    <ul id="track-list" class="track-list"></ul>
  </div>

  <!-- Player (persistent) -->
  <div id="player" class="player hidden">

    <!-- Прогресс с временем над ползунком -->
    <div class="player-progress-wrapper">
      <div class="player-progress">
        <div class="progress-labels">
          <span id="time-current">0:00</span>
          <span id="time-total">0:00</span>
        </div>
        <input id="progress-bar" type="range" min="0" max="1000" value="0" />
      </div>
    </div>

    <!-- Основная панель -->
    <div class="player-main">
      <div class="player-info">
        <img id="player-cover" src="" alt="" />
        <div class="player-text">
          <span id="player-track"></span>
          <span id="player-artist"></span>
        </div>
      </div>

      <!-- Кнопка play только для мини-плеера на мобилке -->
      <button id="btn-mini-play" class="btn-mini-play" title="Play/Pause">
        <svg viewBox="0 0 24 24" fill="currentColor"><path d="M8 5v14l11-7z"/></svg>
      </button>

      <div class="player-center">
        <div class="player-controls">
          <button id="btn-shuffle" title="Shuffle">
            <svg viewBox="0 0 24 24" fill="currentColor"><path d="M10.59 9.17L5.41 4 4 5.41l5.17 5.17 1.42-1.41zM14.5 4l2.04 2.04L4 18.59 5.41 20 17.96 7.46 20 9.5V4h-5.5zm.33 9.41l-1.41 1.41 3.13 3.13L14.5 20H20v-5.5l-2.04 2.04-3.13-3.13z"/></svg>
          </button>
          <button id="btn-prev" title="Previous">
            <svg viewBox="0 0 24 24" fill="currentColor"><path d="M6 6h2v12H6zm3.5 6 8.5 6V6z"/></svg>
          </button>
          <button id="btn-play" title="Play/Pause">
            <svg viewBox="0 0 24 24" fill="currentColor"><path d="M8 5v14l11-7z"/></svg>
          </button>
          <button id="btn-next" title="Next">
            <svg viewBox="0 0 24 24" fill="currentColor"><path d="M6 18l8.5-6L6 6v12zM16 6v12h2V6h-2z"/></svg>
          </button>
          <button id="btn-repeat" title="Repeat">
            <svg viewBox="0 0 24 24" fill="currentColor"><path d="M7 7h10v3l4-4-4-4v3H5v6h2V7zm10 10H7v-3l-4 4 4 4v-3h12v-6h-2v4z"/></svg>
          </button>
        </div>
      </div>

      <div class="player-volume">
        <svg class="volume-icon" viewBox="0 0 24 24" fill="currentColor"><path d="M3 9v6h4l5 5V4L7 9H3zm13.5 3c0-1.77-1.02-3.29-2.5-4.03v8.05c1.48-.73 2.5-2.25 2.5-4.02z"/></svg>
        <input id="volume-bar" type="range" min="0" max="1" step="0.01" value="0.8" />
      </div>
    </div>

  </div>

  <!-- Полноэкранный плеер (мобилка) -->
  <div id="player-fullscreen" class="player-fullscreen">
    <div class="pf-handle-bar"></div>
    <img id="pf-cover" class="pf-cover" src="" alt="" />
    <div class="pf-info">
      <span id="pf-track"></span>
      <span id="pf-artist"></span>
    </div>
    <div class="pf-progress-section">
      <input id="pf-progress" type="range" min="0" max="1000" value="0" />
      <div class="pf-time-labels">
        <span id="pf-time-current">0:00</span>
        <span id="pf-time-total">0:00</span>
      </div>
    </div>
    <div class="pf-controls">
      <button id="pf-shuffle" title="Shuffle">
        <svg viewBox="0 0 24 24" fill="currentColor"><path d="M10.59 9.17L5.41 4 4 5.41l5.17 5.17 1.42-1.41zM14.5 4l2.04 2.04L4 18.59 5.41 20 17.96 7.46 20 9.5V4h-5.5zm.33 9.41l-1.41 1.41 3.13 3.13L14.5 20H20v-5.5l-2.04 2.04-3.13-3.13z"/></svg>
      </button>
      <button id="pf-prev" title="Previous">
        <svg viewBox="0 0 24 24" fill="currentColor"><path d="M6 6h2v12H6zm3.5 6 8.5 6V6z"/></svg>
      </button>
      <button id="pf-play" title="Play/Pause">
        <svg viewBox="0 0 24 24" fill="currentColor"><path d="M8 5v14l11-7z"/></svg>
      </button>
      <button id="pf-next" title="Next">
        <svg viewBox="0 0 24 24" fill="currentColor"><path d="M6 18l8.5-6L6 6v12zM16 6v12h2V6h-2z"/></svg>
      </button>
      <button id="pf-repeat" title="Repeat">
        <svg viewBox="0 0 24 24" fill="currentColor"><path d="M7 7h10v3l4-4-4-4v3H5v6h2V7zm10 10H7v-3l-4 4 4 4v-3h12v-6h-2v4z"/></svg>
      </button>
    </div>
  </div>

  <audio id="audio"></audio>

  <!-- Upload Modal -->
  <div id="upload-modal" class="modal-overlay hidden">
    <div class="modal-box">
      <h2>Новый альбом</h2>

      <div class="form-group">
        <label>Название</label>
        <input type="text" id="upload-title" placeholder="Название альбома" />
      </div>
      <div class="form-group">
        <label>Артист</label>
        <input type="text" id="upload-artist" placeholder="Артист" />
      </div>
      <div class="form-group">
        <label>Год</label>
        <input type="number" id="upload-year" placeholder="2024" min="1900" max="2099" />
      </div>

      <div class="form-group">
        <label>Обложка</label>
        <div class="drop-zone" id="cover-drop-zone">
          <span id="cover-drop-hint">Перетащи или кликни для выбора изображения</span>
          <input type="file" id="upload-cover" accept="image/*" hidden />
        </div>
      </div>

      <div class="form-group">
        <label>Треки</label>
        <div class="drop-zone" id="tracks-drop-zone">
          <span id="tracks-drop-hint">Перетащи или кликни для выбора аудио</span>
          <input type="file" id="upload-tracks" accept="audio/*" multiple hidden />
        </div>
      </div>

      <ul id="modal-track-list" class="modal-tracks-list"></ul>

      <div class="modal-actions">
        <button id="upload-cancel" class="btn-modal-cancel">Отмена</button>
        <button id="upload-save" class="btn-modal-save">Сохранить</button>
      </div>
    </div>
  </div>

  <input type="file" id="add-tracks-input" accept="audio/*" multiple hidden />

  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <script src="supabase-config.js"></script>
  <script src="app.js"></script>
</body>
</html>
